CREATE TABLE config (id INT UNSIGNED AUTO_INCREMENT, wireless_channel TINYINT, wireless_mode ENUM('b', 'g', 'n', 'auto') NOT NULL, update_server VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE device (id INT UNSIGNED AUTO_INCREMENT, config_id INT UNSIGNED NOT NULL, description TEXT, INDEX config_id_idx (config_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE dhcp_server (id INT UNSIGNED, mode3_id INT UNSIGNED NOT NULL, ip VARCHAR(15), INDEX mode3_id_idx (mode3_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE mode2 (id INT UNSIGNED AUTO_INCREMENT, ssid_id INT UNSIGNED, file_path VARCHAR(255) NOT NULL, INDEX ssid_id_idx (ssid_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE mode3 (id INT UNSIGNED AUTO_INCREMENT, ssid_id INT UNSIGNED NOT NULL, retry_interval INT UNSIGNED NOT NULL, own_ip VARCHAR(15) NOT NULL, nas_identifier VARCHAR(48) NOT NULL, dhcprelay_ip VARCHAR(15) NOT NULL, hw_interface VARCHAR(5) NOT NULL, radius_auth_ip VARCHAR(15) NOT NULL, radius_auth_port MEDIUMINT UNSIGNED NOT NULL, radius_auth_shared_secret VARCHAR(255) NOT NULL, radius_auth_interim_interval MEDIUMINT UNSIGNED NOT NULL, radius_acct_auth_ip VARCHAR(15) NOT NULL, radius_acct_auth_port MEDIUMINT UNSIGNED NOT NULL, radius_acct_auth_shared_secret VARCHAR(255) NOT NULL, radius_acct_interim_interval MEDIUMINT UNSIGNED NOT NULL, vpn_auth_server VARCHAR(255) NOT NULL, vpn_auth_port MEDIUMINT UNSIGNED NOT NULL, vpn_auth_cipher ENUM('DES-CBC', 'AES-128-CBC', 'AES-192-CBC', 'AES-256-CBC', 'BF-CBC') NOT NULL, vpn_auth_compression TINYINT(1) NOT NULL, vpn_data_port MEDIUMINT UNSIGNED NOT NULL, vpn_data_cipher ENUM('DES-CBC', 'AES-128-CBC', 'AES-192-CBC', 'AES-256-CBC', 'BF-CBC') NOT NULL, vpn_data_compression TINYINT(1) NOT NULL, INDEX ssid_id_idx (ssid_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE ssid (id INT UNSIGNED AUTO_INCREMENT, config_id INT UNSIGNED NOT NULL, name VARCHAR(32) NOT NULL, vlan SMALLINT, group_rekey_interval INT NOT NULL, broadcast TINYINT(1) NOT NULL, strict_rekey TINYINT(1) NOT NULL, passprase VARCHAR(255), wpa_mode ENUM('wpa', 'wpa2', 'off') NOT NULL, INDEX config_id_idx (config_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group (id INT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group_permission (group_id INT, permission_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(group_id, permission_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_permission (id INT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_remember_key (id INT AUTO_INCREMENT, user_id INT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id, ip_address)) ENGINE = INNODB;
CREATE TABLE sf_guard_user (id INT AUTO_INCREMENT, username VARCHAR(128) NOT NULL UNIQUE, algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active TINYINT(1) DEFAULT '1', is_super_admin TINYINT(1) DEFAULT '0', last_login DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX is_active_idx_idx (is_active), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_group (user_id INT, group_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_permission (user_id INT, permission_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, permission_id)) ENGINE = INNODB;
ALTER TABLE device ADD CONSTRAINT device_config_id_config_id FOREIGN KEY (config_id) REFERENCES config(id);
ALTER TABLE dhcp_server ADD CONSTRAINT dhcp_server_mode3_id_mode3_id FOREIGN KEY (mode3_id) REFERENCES mode3(id);
ALTER TABLE mode2 ADD CONSTRAINT mode2_ssid_id_ssid_id FOREIGN KEY (ssid_id) REFERENCES ssid(id);
ALTER TABLE mode3 ADD CONSTRAINT mode3_ssid_id_ssid_id FOREIGN KEY (ssid_id) REFERENCES ssid(id);
ALTER TABLE ssid ADD CONSTRAINT ssid_config_id_config_id FOREIGN KEY (config_id) REFERENCES config(id);
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_remember_key ADD CONSTRAINT sf_guard_remember_key_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
